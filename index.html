<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portale Utente Aziendale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple spinner for loading state */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <div class="min-h-screen flex flex-col items-center justify-center p-4">
        
        <!-- Main Title -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white">Benvenuto nel portale utente della tua azienda</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">Accesso rapido alle tue applicazioni principali.</p>
        </header>

        <!-- Gemini API Feature: Daily Briefing -->
        <section class="w-full max-w-4xl mb-12">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 text-center">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Il tuo Briefing Quotidiano</h2>
                <p class="text-gray-600 dark:text-gray-400 mt-2 mb-4">Ottieni un riepilogo delle ultime notizie del settore basato sull'intelligenza artificiale.</p>
                <button id="get-briefing-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105">
                    ✨ Genera Riepilogo
                </button>
                <div id="briefing-loader" class="hidden mx-auto mt-6">
                    <div class="loader"></div>
                </div>
                <div id="briefing-result" class="mt-6 text-left hidden p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <!-- AI content will be injected here -->
                </div>
            </div>
        </section>


        <!-- Tiles Grid -->
        <main class="w-full max-w-4xl">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 md:gap-8">

                <!-- OneDrive Tile -->
                <a href="https://onedrive.live.com/" target="_blank" rel="noopener noreferrer" class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 flex flex-col items-center justify-center p-8 text-center">
                    <div class="w-16 h-16 mb-4">
                        <svg class="w-full h-full text-blue-500" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.439 12.013c.898 0 1.597-.132 2.112-.413a3.22 3.22 0 0 0 1.256-1.19c.33-.533.493-1.163.493-1.874a3.63 3.63 0 0 0-.58-2.02a3.35 3.35 0 0 0-1.603-1.428c-.68-.344-1.5-.515-2.437-.515h-2.92v6.925h3.679zm-8.814 0c.937 0 1.636-.132 2.138-.413s.92-.68 1.25-1.19c.33-.533.493-1.163.493-1.874a3.63 3.63 0 0 0-.58-2.02A3.35 3.35 0 0 0 7.28 5.088c-.68-.344-1.488-.515-2.438-.515H1.72v6.925h3.122v.013h.783zm.696-1.31H3.031V6.4h2.24c.734 0 1.294.131 1.678.394c.384.263.637.604.759 1.024c.122.42.182.88.182 1.379c0 .5-.06.96-.182 1.378a1.9 1.9 0 0 1-.759 1.024c-.384.263-.944.394-1.678.394zm8.118 0h-2.31V6.4h2.31c.734 0 1.294.131 1.678.394c.384.263.637.604.76 1.024c.122.42.182.88.182 1.379c0 .5-.06.96-.183 1.378a1.9 1.9 0 0 1-.76 1.024c-.383.263-.943.394-1.677.394zM22.28 14.075c-1.33 0-2.445.492-3.346 1.476a4.92 4.92 0 0 0-1.328 3.518c0 1.357.443 2.503 1.328 3.438c.889.923 2.016 1.384 3.346 1.384c1.293 0 2.373-.461 3.24-1.384c.866-.935 1.3-2.081 1.3-3.438c0-1.393-.434-2.548-1.3-3.518c-.867-.984-1.947-1.476-3.24-1.476zm0 1.31c.989 0 1.79.345 2.404 1.036c.614.69.92 1.58.92 2.67c0 1.063-.306 1.938-.92 2.628c-.614.69-1.415 1.036-2.404 1.036c-.963 0-1.76-.346-2.39-1.036c-.63-.69-.944-1.565-.944-2.628c0-1.09.315-1.98.945-2.67c.63-.691 1.427-1.036 2.39-1.036z"/></svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white">OneDrive</h2>
                    <p class="text-gray-500 dark:text-gray-400 mt-1">Il tuo storage cloud</p>
                </a>

                <!-- Pastebin Tile -->
                <a href="https://pastebin.com/" target="_blank" rel="noopener noreferrer" class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 flex flex-col items-center justify-center p-8 text-center">
                    <div class="w-16 h-16 mb-4">
                        <svg class="w-full h-full text-blue-400" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V6h10v2z"/></svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Pastebin</h2>
                    <p class="text-gray-500 dark:text-gray-400 mt-1">Condividi testo e note</p>
                </a>

                <!-- Facebook Tile -->
                <a href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer" class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 flex flex-col items-center justify-center p-8 text-center">
                    <div class="w-16 h-16 mb-4">
                        <svg class="w-full h-full text-blue-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Facebook</h2>
                    <p class="text-gray-500 dark:text-gray-400 mt-1">Connettiti con i colleghi</p>
                </a>

                <!-- Outlook Tile -->
                <a href="https://outlook.live.com/" target="_blank" rel="noopener noreferrer" class="group bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 flex flex-col items-center justify-center p-8 text-center">
                   <div class="w-16 h-16 mb-4">
                        <svg class="w-full h-full text-blue-700" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-1.5 2L12 11.5 4.5 6h15zM3 18V7.5l9 5.62L21 7.5V18H3z"/></svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Outlook</h2>
                    <p class="text-gray-500 dark:text-gray-400 mt-1">La tua posta elettronica</p>
                </a>
            </div>
        </main>
    </div>
    
    <script>
        const getBriefingBtn = document.getElementById('get-briefing-btn');
        const briefingLoader = document.getElementById('briefing-loader');
        const briefingResult = document.getElementById('briefing-result');

        getBriefingBtn.addEventListener('click', async () => {
            briefingResult.classList.add('hidden');
            briefingLoader.classList.remove('hidden');
            briefingResult.innerHTML = ''; // Clear previous results

            const userQuery = "Riassumi in italiano le 3 notizie più importanti di oggi nel settore della tecnologia aziendale, con un focus sull'Italia.";
            const apiKey = ""; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }], // Enable Google Search grounding
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;

                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Format and display the results
                    let htmlContent = `<p class="whitespace-pre-wrap">${text}</p>`;
                    if (sources.length > 0) {
                        htmlContent += '<h4 class="font-semibold mt-4 mb-2 text-gray-800 dark:text-gray-200">Fonti:</h4><ul class="list-disc list-inside space-y-1">';
                        sources.forEach(source => {
                            htmlContent += `<li><a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:underline">${source.title}</a></li>`;
                        });
                        htmlContent += '</ul>';
                    }
                    briefingResult.innerHTML = htmlContent;

                } else {
                    briefingResult.innerHTML = '<p class="text-red-500">Impossibile generare il riepilogo. La risposta dell\'API era in un formato imprevisto.</p>';
                }

            } catch (error) {
                console.error('Error fetching briefing:', error);
                briefingResult.innerHTML = '<p class="text-red-500">Si è verificato un errore durante il recupero del briefing. Per favore, riprova più tardi.</p>';
            } finally {
                briefingLoader.classList.add('hidden');
                briefingResult.classList.remove('hidden');
            }
        });
        
        // Fetch with exponential backoff retry mechanism
        async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) { // Don't retry on non-throttling errors
                        return response;
                    }
                } catch (error) {
                    if (i === retries - 1) throw error;
                }
                // Wait for the delay and then double it for the next potential retry
                await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
            }
        }

    </script>
</body>
</html>


